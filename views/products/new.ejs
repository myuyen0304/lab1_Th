<%- include('../partials/header') %>
<div class="container mt-4">
  <h2>Thêm sản phẩm</h2>
  <form action="/products/new" method="POST" id="productForm">
    <div class="mb-3">
      <label class="form-label">Tên:</label>
      <input
        type="text"
        class="form-control"
        name="name"
        id="name"
        required
        minlength="2"
        maxlength="100"
        title="Tên sản phẩm không được chỉ chứa toàn số"
      />
      <div class="invalid-feedback">
        Tên sản phẩm không được chỉ chứa toàn số
      </div>
    </div>
    <div class="mb-3">
      <label class="form-label">Giá:</label>
      <input
        type="number"
        class="form-control"
        name="price"
        id="price"
        required
        min="0.01"
        max="999999999"
        step="0.01"
        title="Giá phải lớn hơn 0"
      />
      <div class="invalid-feedback">Giá phải lớn hơn 0</div>
    </div>
    <div class="mb-3">
      <label class="form-label">Số lượng:</label>
      <input
        type="number"
        class="form-control"
        name="quantity"
        id="quantity"
        required
        min="0"
        max="999999"
        step="1"
        title="Số lượng phải là số nguyên không âm"
      />
      <div class="invalid-feedback">Số lượng phải là số nguyên không âm</div>
    </div>
    <div class="mb-3">
      <label class="form-label">Nhà cung cấp:</label>
      <select class="form-select" name="supplierId" id="supplierId" required>
        <option value="">-- Chọn nhà cung cấp --</option>
        <% suppliers && suppliers.forEach(supplier => { %>
        <option value="<%= supplier._id %>"><%= supplier.name %></option>
        <% }) %>
      </select>
      <div class="invalid-feedback">Vui lòng chọn nhà cung cấp</div>
    </div>
    <button type="submit" class="btn btn-primary">Thêm</button>
    <a href="/products" class="btn btn-secondary ms-2">Quay lại</a>
  </form>
</div>

<script>
  // Client-side validation
  document
    .getElementById("productForm")
    .addEventListener("submit", function (e) {
      const name = document.getElementById("name").value.trim();
      const price = parseFloat(document.getElementById("price").value);
      const quantity = parseInt(document.getElementById("quantity").value);

      // Kiểm tra tên không được chỉ chứa toàn số
      if (/^\d+$/.test(name)) {
        alert("Tên sản phẩm không được chỉ chứa toàn số!");
        e.preventDefault();
        return false;
      }

      // Kiểm tra giá phải lớn hơn 0
      if (isNaN(price) || price <= 0) {
        alert("Giá phải là số và lớn hơn 0!");
        e.preventDefault();
        return false;
      }

      // Kiểm tra số lượng
      if (isNaN(quantity) || quantity < 0 || !Number.isInteger(quantity)) {
        alert("Số lượng phải là số nguyên không âm!");
        e.preventDefault();
        return false;
      }
    });
</script>

<%- include('../partials/footer') %>
